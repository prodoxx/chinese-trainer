# Nixpacks configuration for Bun
[phases.setup]
nixPkgs = ["bun", "openssl_3"]
aptPkgs = ["curl", "unzip", "libssl-dev", "libssl3", "ca-certificates"]

[phases.install]
# Use frozen lockfile for consistent installs
cmds = ["bun install --frozen-lockfile"]

[phases.build]
# Build the Next.js application
# Generate Prisma client and build Next.js
cmds = [
  "bunx prisma generate --schema=./prisma/schema.prisma",
  "echo 'Building Next.js application...'",
  "bun run build"
]

[start]
# Start the production server
cmd = "bun run start"

[variables]
# Environment variables
NODE_ENV = "production"
# Ensure Bun uses production optimizations
BUN_ENV = "production"